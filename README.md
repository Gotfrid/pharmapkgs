
<!-- README.md is generated from README.Rmd. Please edit that file -->

# pharmapkgs

<!-- badges: start -->
<!-- badges: end -->

The goal of `{pharmapkgs}` is to facilitate the interfacing with
CRAN-like repositories of validated packages with risk metrics.

## Installation

``` r
# install.packages("devtools")
devtools::install_github("pharmaR/pharmapkgs")
```

## Bare bones demo

All available packages from local repository.

``` r
library(pharmapkgs)

# A local repository, bundled with pharmapkgs.
(repo <- bundled_repos("ubuntu-22.04"))
#> [1] "file:///home/rmagno/R/x86_64-pc-linux-gnu-library/4.4/pharmapkgs/repos/ubuntu-22.04/4.4/src/contrib"

# No filtering.
all_pkgs <-
  available.packages(contriburl = repo,
                     fields = risk_fields(repo)) |>
  tibble::as_tibble()

dplyr::glimpse(all_pkgs)
#> Rows: 106
#> Columns: 34
#> $ Package               <chr> "colorspace", "farver", "isoband", "magrittr", "…
#> $ Version               <chr> "2.1-0", "2.1.1", "0.2.7", "2.0.3", "0.5.0", "1.…
#> $ Priority              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Depends               <chr> "R (>= 3.0.0), methods, R (>= 4.4), R (< 4.4.99)…
#> $ Imports               <chr> "graphics, grDevices, stats", NA, "grid, utils",…
#> $ LinkingTo             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Suggests              <chr> "datasets, utils, KernSmooth, MASS, kernlab, mvt…
#> $ Enhances              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License_is_FOSS       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License_restricts_use <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ OS_type               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Archs                 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ MD5sum                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ NeedsCompilation      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ File                  <chr> "colorspace_2.1-0_b1_R4.4_x86_64-pc-linux-gnu-ub…
#> $ NewsCurrent           <chr> "1", "1", "1", "1", "1", "1", "0", "1", "0", "1"…
#> $ HasVignettes          <chr> "1", "0", "1", "1", "0", "1", "0", "0", "0", "1"…
#> $ SizeCodebase          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ HasBugReportsUrl      <chr> "1", "1", "1", "1", "0", "1", "1", "1", "0", "1"…
#> $ BugsStatus            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ ExportHelp            <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ ReverseDependencies   <chr> "0.997967259182271", "0.707229461206214", "0.594…
#> $ Downloads1Yr          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Dependencies          <chr> "0.5", "0.880797077977882", NA, "0.8807970779778…
#> $ HasWebsite            <chr> "1", "1", "1", "1", "1", "1", "1", "1", "0", "1"…
#> $ RCmdCheck             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ RemoteChecks          <chr> "0.923076923076923", "0.807692307692308", "0.807…
#> $ HasMaintainer         <chr> "1", "1", "1", "1", "1", "1", "1", "1", "1", "1"…
#> $ ExportedNamespace     <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ HasNews               <chr> "1", "1", "1", "1", "1", "1", "0", "1", "0", "1"…
#> $ HasSourceControl      <chr> "0", "1", "0", "1", "1", "1", "1", "1", "0", "1"…
#> $ CovrCoverage          <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Repository            <chr> "file:///home/rmagno/R/x86_64-pc-linux-gnu-libra…
```

Packages filtered using `{riskmetrics}` criteria.

``` r
# Fancy criteria. 
my_filters <- risk_filter(ReverseDependencies < 0.5, HasNews == "1", RemoteChecks > 0.9)

# Validated packages.
val_pkgs <-
  available.packages(contriburl = repo,
                     fields = risk_fields(repo),
                     filters = my_filters) |>
  tibble::as_tibble()

dplyr::glimpse(val_pkgs)
#> Rows: 6
#> Columns: 34
#> $ Package               <chr> "munsell", "jds.rmd", "sourcetools", "rversions"…
#> $ Version               <chr> "0.5.0", "0.3.3", "0.1.7-1", "2.1.2", "1.0.1", "…
#> $ Priority              <chr> NA, NA, NA, NA, NA, NA
#> $ Depends               <chr> "R (>= 4.4), R (< 4.4.99)", "R (>= 3.2.3), R (>=…
#> $ Imports               <chr> "colorspace, methods", "bookdown, rmarkdown", NA…
#> $ LinkingTo             <chr> NA, NA, NA, NA, NA, NA
#> $ Suggests              <chr> "ggplot2, testthat", NA, "testthat", "covr, mock…
#> $ Enhances              <chr> NA, NA, NA, NA, NA, NA
#> $ License               <chr> NA, NA, NA, NA, NA, NA
#> $ License_is_FOSS       <chr> NA, NA, NA, NA, NA, NA
#> $ License_restricts_use <chr> NA, NA, NA, NA, NA, NA
#> $ OS_type               <chr> NA, NA, NA, NA, NA, NA
#> $ Archs                 <chr> NA, NA, NA, NA, NA, NA
#> $ MD5sum                <chr> NA, NA, NA, NA, NA, NA
#> $ NeedsCompilation      <chr> NA, NA, NA, NA, NA, NA
#> $ File                  <chr> "munsell_0.5.0_b1_R4.4_x86_64-pc-linux-gnu-ubunt…
#> $ NewsCurrent           <chr> "1", "1", "1", "1", "1", "1"
#> $ HasVignettes          <chr> "0", "0", "0", "0", "0", "0"
#> $ SizeCodebase          <chr> NA, NA, NA, NA, NA, NA
#> $ HasBugReportsUrl      <chr> "0", "1", "1", "1", "1", "1"
#> $ BugsStatus            <chr> NA, NA, NA, NA, NA, NA
#> $ ExportHelp            <chr> NA, NA, NA, NA, NA, NA
#> $ ReverseDependencies   <chr> "0.43732917979627", "0.246376140522644", "0.4705…
#> $ Downloads1Yr          <chr> NA, NA, NA, NA, NA, NA
#> $ Dependencies          <chr> NA, "0.731058578630005", "0.880797077977882", NA…
#> $ HasWebsite            <chr> "1", "1", "0", "1", "1", "1"
#> $ RCmdCheck             <chr> NA, NA, NA, NA, NA, NA
#> $ RemoteChecks          <chr> "1", "1", "1", "1", "0.942307692307692", "1"
#> $ HasMaintainer         <chr> "1", "1", "1", "1", "1", "1"
#> $ ExportedNamespace     <chr> NA, NA, NA, NA, NA, NA
#> $ HasNews               <chr> "1", "1", "1", "1", "1", "1"
#> $ HasSourceControl      <chr> "1", "1", "0", "1", "1", "1"
#> $ CovrCoverage          <chr> NA, NA, NA, NA, NA, NA
#> $ Repository            <chr> "file:///home/rmagno/R/x86_64-pc-linux-gnu-libra…
```

``` r
# Install one of the validated packages with pak.
pak::pkg_install("standard::munsell", lib = "test_lib")
```

## Not working

Filtering through `options()` does not seem to work.

``` r
# Not working.
options(fields = risk_fields(repo),
        available_package_filters = my_filters)
available.packages(contriburl = repo) |>
  tibble::as_tibble() |>
  dplyr::glimpse()
#> Rows: 106
#> Columns: 17
#> $ Package               <chr> "colorspace", "farver", "isoband", "magrittr", "…
#> $ Version               <chr> "2.1-0", "2.1.1", "0.2.7", "2.0.3", "0.5.0", "1.…
#> $ Priority              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Depends               <chr> "R (>= 3.0.0), methods, R (>= 4.4), R (< 4.4.99)…
#> $ Imports               <chr> "graphics, grDevices, stats", NA, "grid, utils",…
#> $ LinkingTo             <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Suggests              <chr> "datasets, utils, KernSmooth, MASS, kernlab, mvt…
#> $ Enhances              <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License_is_FOSS       <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ License_restricts_use <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ OS_type               <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ Archs                 <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ MD5sum                <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ NeedsCompilation      <chr> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
#> $ File                  <chr> "colorspace_2.1-0_b1_R4.4_x86_64-pc-linux-gnu-ub…
#> $ Repository            <chr> "file:///home/rmagno/R/x86_64-pc-linux-gnu-libra…
```

## TODO

- Modify installed package DESCRIPTION post-installation to include
  metrics
- “report” that uses metrics/logs to populate a template
